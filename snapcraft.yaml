name: core
version: 16-2
version-script: |
    # remember to keep version script in sync with "Makefile"
    echo "16-$(cat prime/usr/lib/snapd/info |cut -f2 -d=| sed s/~ubuntu.*// | cut -b1-29)"
summary: snapd runtime environment
description: The core runtime environment for snapd
confinement: strict
type: os
grade: stable

plugs:
  core-support-plug:
    interface: core-support

hooks:
  configure:
    plugs: [core-support-plug]

parts:
  hooks:
    plugin: dump
    source: hooks
    organize:
      configure: meta/hooks/configure

  manifest:
    plugin: dump
    source: manifest-fixup
    stage:
      - update-stage-pkgs.py
    prime:
      - -update-stage-pkgs.py

  livebuild:
    source: .
    plugin: make
    build-packages:
      - livecd-rootfs
      - shellcheck
      - gawk
      - python3-yaml
    after:
      - hooks
      - manifest
    override-prime: |
      ls -al $(pwd)/..
      ls -al $SNAPCRAFT_STAGE
      ls -al snap/
      snapcraftctl prime
      ls -al snap/
      ls -al $(pwd)
      python3 $SNAPCRAFT_STAGE/update-stage-pkgs.py $(pwd)/../
